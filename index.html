<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<link href="./css/viewer.css" rel="stylesheet">

<script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="https://cdn.steemjs.com/lib/latest/steem.min.js"></script>
<script src="https://fb.me/react-15.0.0.js"></script>
<script src="https://fb.me/react-dom-15.0.0.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.34/browser.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js"></script>


<div id="main_panel"></div>


<!-- Modal -->
<div class="modal fade" id="pleaseWaitDialog" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true"  data-backdrop="static" data-keyboard="false">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-body">
                <h4>Processing...</h4>
            <div class="progress">
                <div class="progress-bar progress-bar-striped active" role="progressbar"
                aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width:100%">
                </div>
            </div>
        </div>
      </div>
    </div>
  </div>



<script>

steem.api.setWebSocket('wss://steemd-int.steemit.com');

/*
var my_steemit_post = JSON.parse(localStorage.getItem("my_steemit_post")) || [];  //
function get_post(last_post) {
    if (localStorage.getItem("my_steemit_post")) {
        done();
        return;
    }
    steem.api.getDiscussionsByAuthorBeforeDate(
        'asbear',
        last_post?last_post.permlink: '',
        last_post?last_post.active: '2030-01-01T00:00:00',
        100,
        function (err, result) {
            if (result.length > 1) {
                my_steemit_post.push.apply(my_steemit_post, result);
                get_post(result[result.length-1])
            } else {
                done();
            }
        }
    );
}
function done() {
    localStorage.setItem("my_steemit_post", JSON.stringify(my_steemit_post));
    show_posting_list();
}

function show_posting_list() {
    $('#post_list').html('');
    var table = $("<table/>", {class: 'table'});
    table.append(
            $("<tr><td>제목</td><td>보팅</td><td>댓글</td><td>보상</td></tr>"));
    my_steemit_post.forEach(function(post) {
        table.append(
            $("<tr/>")
            .append($('<td/>').text(post.title))
            .append($('<td/>').text(post.net_votes))
            .append($('<td/>').text(post.children))
            .append($('<td/>').text(post.total_payout_value))
        );
    });
    $('#post_list').append(table);
}

function saveFile (name, type, data) {
    if (data != null && navigator.msSaveBlob)
        return navigator.msSaveBlob(new Blob([data], { type: type }), name);
    var a = $("<a style='display: none;'/>");
    var url = window.URL.createObjectURL(new Blob([data], {type: type}));
    a.attr("href", url);
    a.attr("download", name);
    $("body").append(a);
    a[0].click();
    window.URL.revokeObjectURL(url);
    a.remove();
}

function download_all() {
    saveFile("Example.txt", "data:attachment/text", JSON.stringify(my_steemit_post));
}
*/
//get_post();
/*
(function() {

  // call the main function
  whoUpvotedMe('pilcrow').then(result => {
    // print the results in the HTML
    document.getElementById('counter').innerText = JSON.stringify(result, null, 4);
  });

  function whoUpvotedMe(username) {
    return steem.api.getDiscussionsByAuthorBeforeDate(username, null, '2100-01-01T00:00:00', 100)
      .then(posts => {
          const allUpvoters = getAllUpvoters(posts);
          return countUpvoters(allUpvoters);
      });
  }
    
  function getUpvoters(post) {
      return post.active_votes.map(upvote => upvote.voter);
  }
  
  posts.reduce((all, post) => { return all.concat(post.active_votes.map(upvote => upvote.voter)); }, [])
  .reduce((upvoteCounts, upvoter) => {
      upvoteCounts[upvoter] = (upvoteCounts[upvoter] || 0) + 1;
      return upvoteCounts;
      },{});

  function getAllUpvoters(posts) {
    return posts.reduce((all, currentPost) => {
        const upvoters = getUpvoters(currentPost)
        return all.concat(upvoters);
    }, []);
	}
  
  function countUpvoters(allUpvoters) {
   return allUpvoters.reduce((upvoteCounts, upvoter) => {
  upvoteCounts[upvoter] = (upvoteCounts[upvoter] || 0) + 1;
        return upvoteCounts;
    }, {});
	}
})();
*/

</script>

<script type="text/babel" src="./js/viewer.jsx"></script>
<script type="text/babel" src="./js/main.jsx"></script>